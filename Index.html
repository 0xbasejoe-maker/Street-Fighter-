<!DOCTYPE html>
<html>
<head>
    <title>Nokia Street Fighter 2 - AI Edition</title>
    <style>
        body { 
            background: #000; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            font-family: monospace; 
            color: #0f0; 
            image-rendering: pixelated;
        }
        canvas { 
            border: 2px solid #0f0; 
            width: 240px; 
            height: 268px;
            background: #111;
        }
        .controls { 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            font-size: 12px;
            text-shadow: 0 0 5px #0f0;
        }
        .title {
            font-size: 24px;
            margin-bottom: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="title">STREET FIGHTER II<br><small>Nokia AI Edition</small></div>
    <canvas id="game" width="168" height="188"></canvas>
    <div class="controls">
        A/D Move, W Jump, Q Punch, S Kick<br>
        R: Restart
    </div>
    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = false;
        ctx.scale(2, 2);

        const TILE = 4;
        const W = 84;
        const H = 94;
        const HEALTH_MAX = 100;

        let p1 = { x: 10, y: 70, vx: 0, vy: 0, health: HEALTH_MAX, facing: 1, state: 'idle', punch: 0, kick: 0 };
        let p2 = { x: 60, y: 70, vx: 0, vy: 0, health: HEALTH_MAX, facing: -1, state: 'idle', punch: 0, kick: 0 };
        let keys = {};
        let score1 = 0, score2 = 0;
        let winner = null;
        let aiTimer = 0;

        function drawFighter(f, color) {
            ctx.fillStyle = color;
            ctx.fillRect(f.x, f.y, 6, 12);
            ctx.fillRect(f.x+1, f.y-3, 4, 4);
            ctx.fillRect(f.x+1, f.y+12, 2, 4);
            ctx.fillRect(f.x+3, f.y+12, 2, 4);
            if (f.punch > 0) {
                ctx.fillRect(f.x + (f.facing > 0 ? 6 : -4), f.y+2, 4*f.facing, 2);
            }
            if (f.kick > 0) {
                ctx.fillRect(f.x+3, f.y+10, 4*f.facing, 3);
            }
            if (f.vy < 0) {
                ctx.fillRect(f.x-1, f.y-2, 8, 2);
            }
        }

        function aiUpdate() {
            aiTimer++;
            let dist = p2.x - p1.x;
            let shouldAttack = Math.abs(dist) < 20 && p1.y === 70 && p2.y === 70;
            let p1Attacking = p1.punch > 0 || p1.kick > 0;
            let random = Math.random();

            // Move toward player if far
            if (dist > 15 && random < 0.7) {
                p2.vx = 1;
                p2.facing = 1;
            } else if (dist < -15 && random < 0.7) {
                p2.vx = -1;
                p2.facing = -1;
            } else {
                p2.vx = 0;
            }

            // Jump over if too close and player grounded
            if (Math.abs(dist) < 10 && p1.y === 70 && p2.y === 70 && random < 0.4) {
                p2.vy = -8;
            }

            // Attack logic
            if (shouldAttack && aiTimer % 30 === 0) {
                if (random < 0.6) {
                    p2.punch = 10; // Punch more often
                } else {
                    p2.kick = 12;
                }
            }

            // Defensive jump/block if player attacking close
            if (p1Attacking && Math.abs(dist) < 15 && p2.y === 70 && random < 0.5) {
                p2.vy = -8;
            }

            // Random attack even if not close (aggressive AI)
            if (aiTimer % 80 === 0 && random < 0.3) {
                if (random < 0.7) p2.punch = 10;
                else p2.kick = 12;
            }
        }

        function draw() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, W, H);

            ctx.fillStyle = '#555';
            ctx.fillRect(0, 80, W, H-80);

            drawFighter(p1, '#0f0');
            drawFighter(p2, '#f80');

            ctx.fillStyle = '#f00';
            ctx.fillRect(5, 5, p1.health, 4);
            ctx.fillRect(W-105, 5, p2.health, 4);
            ctx.fillStyle = '#0f0';
            ctx.fillRect(5, 5, HEALTH_MAX, 4);
            ctx.fillRect(W-105, 5, HEALTH_MAX, 4);

            ctx.fillStyle = '#ff0';
            ctx.font = '8px monospace';
            ctx.fillText('P1: ' + score1, 5, 20);
            ctx.fillText('P2 AI: ' + score2, W-50, 20);

            if (winner) {
                ctx.fillStyle = '#fff';
                ctx.font = '12px monospace';
                ctx.fillText(winner + ' WINS!', 20, 45);
            }
        }

        function update() {
            if (winner) return;

            // P1 Input
            p1.vx = 0;
            if (keys['a'] || keys['A']) { p1.vx = -1; p1.facing = -1; }
            if (keys['d'] || keys['D']) { p1.vx = 1; p1.facing = 1; }
            if ((keys['w'] || keys['W']) && p1.y === 70) p1.vy = -8;
            if (keys['q'] || keys['Q']) p1.punch = 10;
            if (keys['s'] || keys['S']) p1.kick = 12;

            // P2 AI
            aiUpdate();

            // Physics
            [p1, p2].forEach(f => {
                f.x += f.vx;
                if (f.vy !== 0) { f.y += f.vy; f.vy += 0.5; }
                if (f.y > 70) { f.y = 70; f.vy = 0; }

                f.x = Math.max(0, Math.min(W-10, f.x));

                f.punch = Math.max(0, f.punch - 1);
                f.kick = Math.max(0, f.kick - 1);
            });

            // Collisions
            if (Math.abs(p1.x - p2.x) < 12 && Math.abs(p1.y - p2.y) < 10) {
                if (p1.punch > 0 || p1.kick > 0) p2.health -= 0.5;
                if (p2.punch > 0 || p2.kick > 0) p1.health -= 0.5;
            }

            // Win
            if (p1.health <= 0) { score2++; winner = 'AI'; setTimeout(restart, 2000); }
            if (p2.health <= 0) { score1++; winner = 'YOU'; setTimeout(restart, 2000); }
        }

        function restart() {
            p1 = { x: 10, y: 70, vx: 0, vy: 0, health: HEALTH_MAX, facing: 1, state: 'idle', punch: 0, kick: 0 };
            p2 = { x: 60, y: 70, vx: 0, vy: 0, health: HEALTH_MAX, facing: -1, state: 'idle', punch: 0, kick: 0 };
            winner = null;
            aiTimer = 0;
        }

        document.addEventListener('keydown', e => keys[e.key] = true);
        document.addEventListener('keyup', e => keys[e.key] = false);
        document.addEventListener('keydown', e => {
            if (e.key.toLowerCase() === 'r') restart();
        });

        setInterval(() => { update(); draw(); }, 100);
        draw();
    </script>
</body>
</html>
